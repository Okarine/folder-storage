<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Folder List</title>
</head>
<body>
    <h1>Folder List</h1>
    <nav id="breadcrumbs"></nav>
    <input type="text" id="search-input" placeholder="Search">
    <button id="up-button" style="display: none;">‚¨ÜÔ∏è UP</button>
    <div id="folder-list"></div>

    <!-- FOLDER_LIST_PLACEHOLDER -->
    
    <script>
        const folderListElement = document.getElementById('folder-list');
        const breadcrumbsElement = document.getElementById('breadcrumbs');
        const upButton = document.getElementById('up-button');
        const searchInput = document.getElementById('search-input');

        function renderUpButton() {
            const currentPath = window.location.pathname;

            if (currentPath !== '/') {
                upButton.style.display = 'block';
            } else {
                upButton.style.display = 'none';
            }

            upButton.onclick = function() {
                const pathParts = currentPath.split('/').filter(Boolean);

                if (pathParts.length > 1) {
                    const newPath = '/' + pathParts.slice(0, -1).join('/') + '/';
                    window.location.href = newPath;
                } else {
                    window.location.href = '/';
                }
            }
        }

        function renderBreadcrumbs() {
            const pathParts = window.location.pathname.split('/').filter(Boolean);
            let accumulatedPath = '/';

            // Clearing the breadcrumb element before rendering
            breadcrumbsElement.innerHTML = '';

            // Add a link to the root directory
            const rootCrumb = document.createElement('a');
            rootCrumb.href = '/';
            rootCrumb.textContent = '/';
            breadcrumbsElement.appendChild(rootCrumb);

            // We build breadcrumbs for each segment of the path
            pathParts.forEach((part, index) => {
                accumulatedPath += encodeURIComponent(part) + '/'

                const crumb = document.createElement('a');
                crumb.href = accumulatedPath;
                crumb.textContent = part;

                breadcrumbsElement.appendChild(crumb);
                breadcrumbsElement.appendChild(document.createTextNode(' / '));
            });

        }

        function renderFileList(fileList) {
            folderListElement.innerHTML = '';   
            
            fileList.forEach(file => {
                const listItem = document.createElement('div');
                listItem.style.display = 'block';
                const a = document.createElement('a')
                
                if (file.isDirectory) {
                    a.href = `${window.location.pathname}${encodeURIComponent(file.path)}/`;
                    a.textContent = `üìÅ` + file.name;
                } else {
                    a.href = `${window.location.pathname}${encodeURIComponent(file.path)}`;
                    a.download = file.name;
                    a.textContent = `üìÑ` + file.name
                }

                listItem.appendChild(a);
                folderListElement.appendChild(listItem);
            });
        }

        searchInput.oninput = function () {
            let val = this.value.trim().toLowerCase();
            let filteredItems = document.querySelectorAll('#folder-list div');
            if (val != '') {
                filteredItems.forEach(function (elem) {
                    if (elem.innerText.search(val) == -1) {
                        elem.style.display = 'none';
                    } else {
                        elem.style.display = 'block';
                    }
                });
            } else {
                filteredItems.forEach(function (elem) {
                    elem.style.display = 'block';
                });
            }
        }

        renderUpButton();
        renderBreadcrumbs();
        renderFileList(fileList);
    </script>
</body>
</html>

